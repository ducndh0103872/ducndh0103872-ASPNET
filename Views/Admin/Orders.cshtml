@{
    ViewData["Title"] = "Quản Lý Đơn Hàng - Admin Panel";
    Layout = "_AdminLayout";

    // Mock data for demonstration
    var mockOrders = new List<dynamic>
    {
        new { Id = 1, OrderNumber = "DH001", CustomerName = "Nguyễn Văn An", CustomerEmail = "an.nguyen@email.com", CustomerPhone = "0901234567", TotalAmount = 2200000, Status = 1, PaymentStatus = 1, CreatedAt = DateTime.Now.AddHours(-2), ProductCount = 2 },
        new { Id = 2, OrderNumber = "DH002", CustomerName = "Trần Thị Bình", CustomerEmail = "binh.tran@email.com", CustomerPhone = "0912345678", TotalAmount = 1650000, Status = 2, PaymentStatus = 1, CreatedAt = DateTime.Now.AddHours(-5), ProductCount = 1 },
        new { Id = 3, OrderNumber = "DH003", CustomerName = "Lê Văn Cường", CustomerEmail = "cuong.le@email.com", CustomerPhone = "0923456789", TotalAmount = 3200000, Status = 3, PaymentStatus = 1, CreatedAt = DateTime.Now.AddDays(-1), ProductCount = 3 },
        new { Id = 4, OrderNumber = "DH004", CustomerName = "Phạm Thị Dung", CustomerEmail = "dung.pham@email.com", CustomerPhone = "0934567890", TotalAmount = 990000, Status = 4, PaymentStatus = 1, CreatedAt = DateTime.Now.AddDays(-2), ProductCount = 1 },
        new { Id = 5, OrderNumber = "DH005", CustomerName = "Hoàng Văn Em", CustomerEmail = "em.hoang@email.com", CustomerPhone = "0945678901", TotalAmount = 1450000, Status = 5, PaymentStatus = 1, CreatedAt = DateTime.Now.AddDays(-3), ProductCount = 2 },
        new { Id = 6, OrderNumber = "DH006", CustomerName = "Vũ Thị Phương", CustomerEmail = "phuong.vu@email.com", CustomerPhone = "0956789012", TotalAmount = 520000, Status = 0, PaymentStatus = 0, CreatedAt = DateTime.Now.AddMinutes(-30), ProductCount = 1 },
        new { Id = 7, OrderNumber = "DH007", CustomerName = "Đỗ Văn Giang", CustomerEmail = "giang.do@email.com", CustomerPhone = "0967890123", TotalAmount = 2800000, Status = 6, PaymentStatus = 2, CreatedAt = DateTime.Now.AddDays(-7), ProductCount = 1 }
    };

    ViewBag.TotalItems = mockOrders.Count;
    ViewBag.CurrentPage = 1;
    ViewBag.TotalPages = 1;
}

<!-- Page Header -->
<div class="page-header">
    <div class="d-flex justify-content-between align-items-center">
        <div>
            <h1 class="h3 mb-0">Quản Lý Đơn Hàng</h1>
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="@Url.Action("Index", "Admin")">Dashboard</a></li>
                    <li class="breadcrumb-item active">Đơn Hàng</li>
                </ol>
            </nav>
        </div>
        <div>
            <button class="btn btn-outline-secondary" onclick="exportToCSV('ordersTable', 'orders.csv')">
                <i class="fas fa-download me-2"></i>Xuất Báo Cáo
            </button>
        </div>
    </div>
</div>

<!-- Filters -->
<div class="card mb-4">
    <div class="card-body">
        <div class="row">
            <div class="col-md-3">
                <input type="text" class="form-control" id="searchOrders" placeholder="Tìm kiếm đơn hàng..." data-table-search="ordersTable">
            </div>
            <div class="col-md-2">
                <select class="form-select" id="filterStatus">
                    <option value="">Tất cả trạng thái</option>
                    <option value="pending">Chờ xử lý</option>
                    <option value="confirmed">Đã xác nhận</option>
                    <option value="processing">Đang xử lý</option>
                    <option value="shipping">Đang giao hàng</option>
                    <option value="delivered">Đã giao hàng</option>
                    <option value="cancelled">Đã hủy</option>
                </select>
            </div>
            <div class="col-md-2">
                <input type="date" class="form-control" id="filterDateFrom" placeholder="Từ ngày">
            </div>
            <div class="col-md-2">
                <input type="date" class="form-control" id="filterDateTo" placeholder="Đến ngày">
            </div>
            <div class="col-md-3">
                <div class="btn-group" role="group">
                    <button class="btn btn-outline-secondary" onclick="exportToCSV('ordersTable', 'orders.csv')">
                        <i class="fas fa-download me-1"></i>Xuất CSV
                    </button>
                    <button class="btn btn-outline-secondary" onclick="printTable('ordersTable')">
                        <i class="fas fa-print me-1"></i>In
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Orders Table -->
<div class="card admin-table">
    <div class="card-header d-flex justify-content-between align-items-center">
        <h5 class="mb-0">Danh Sách Đơn Hàng (@ViewBag.TotalItems đơn hàng)</h5>
        <div class="d-flex align-items-center">
            <span class="text-muted me-3">Trang @ViewBag.CurrentPage / @ViewBag.TotalPages</span>
        </div>
    </div>
    <div class="card-body p-0">
        @if (mockOrders.Any())
        {
            <div class="table-responsive">
                <table class="table table-hover mb-0" id="ordersTable">
                    <thead>
                        <tr>
                            <th>Mã Đơn</th>
                            <th>Khách Hàng</th>
                            <th>Email</th>
                            <th>Số Điện Thoại</th>
                            <th>Tổng Tiền</th>
                            <th>Trạng Thái</th>
                            <th>Thanh Toán</th>
                            <th>Ngày Đặt</th>
                            <th>Thao Tác</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var order in mockOrders)
                        {
                            <tr>
                                <td>
                                    <strong>#@order.OrderNumber</strong>
                                    <br><small class="text-muted">@order.ProductCount sản phẩm</small>
                                </td>
                                <td>
                                    <div>
                                        <strong>@order.CustomerName</strong>
                                    </div>
                                </td>
                                <td>@order.CustomerEmail</td>
                                <td>@order.CustomerPhone</td>
                                <td>
                                    <strong class="text-success">@order.TotalAmount.ToString("N0") VNĐ</strong>
                                </td>
                                <td>
                                    @{
                                        var statusClass = order.Status switch
                                        {
                                            0 => "bg-warning",
                                            1 => "bg-info",
                                            2 => "bg-primary",
                                            3 => "bg-secondary",
                                            4 => "bg-success",
                                            5 => "bg-danger",
                                            6 => "bg-dark",
                                            _ => "bg-secondary"
                                        };

                                        var statusText = order.Status switch
                                        {
                                            0 => "Chờ xử lý",
                                            1 => "Đã xác nhận",
                                            2 => "Đang xử lý",
                                            3 => "Đang giao",
                                            4 => "Đã giao",
                                            5 => "Đã hủy",
                                            6 => "Đã trả",
                                            _ => "Không xác định"
                                        };
                                    }
                                    <span class="badge @statusClass">@statusText</span>
                                </td>
                                <td>
                                    @{
                                        var paymentClass = order.PaymentStatus switch
                                        {
                                            0 => "bg-warning",
                                            1 => "bg-success",
                                            2 => "bg-danger",
                                            3 => "bg-info",
                                            _ => "bg-secondary"
                                        };

                                        var paymentText = order.PaymentStatus switch
                                        {
                                            0 => "Chờ thanh toán",
                                            1 => "Đã thanh toán",
                                            2 => "Thất bại",
                                            3 => "Đã hoàn tiền",
                                            _ => "Không xác định"
                                        };
                                    }
                                    <span class="badge @paymentClass">@paymentText</span>
                                </td>
                                <td>
                                    @order.CreatedAt.ToString("dd/MM/yyyy")
                                    <br><small class="text-muted">@order.CreatedAt.ToString("HH:mm")</small>
                                </td>
                                <td>
                                    <div class="action-buttons">
                                        <button class="btn btn-outline-primary btn-sm" data-bs-toggle="tooltip" title="Xem chi tiết">
                                            <i class="fas fa-eye"></i>
                                        </button>

                                        @if (order.Status == 0)
                                        {
                                            <button class="btn btn-success btn-sm"
                                                    onclick="updateOrderStatus(@order.Id, 1)"
                                                    data-bs-toggle="tooltip"
                                                    title="Xác nhận đơn hàng">
                                                <i class="fas fa-check"></i>
                                            </button>
                                        }

                                        @if (order.Status == 1)
                                        {
                                            <button class="btn btn-primary btn-sm"
                                                    onclick="updateOrderStatus(@order.Id, 2)"
                                                    data-bs-toggle="tooltip"
                                                    title="Bắt đầu xử lý">
                                                <i class="fas fa-cog"></i>
                                            </button>
                                        }

                                        @if (order.Status == 2)
                                        {
                                            <button class="btn btn-secondary btn-sm"
                                                    onclick="updateOrderStatus(@order.Id, 3)"
                                                    data-bs-toggle="tooltip"
                                                    title="Giao hàng">
                                                <i class="fas fa-truck"></i>
                                            </button>
                                        }

                                        @if (order.Status == 3)
                                        {
                                            <button class="btn btn-success btn-sm"
                                                    onclick="updateOrderStatus(@order.Id, 4)"
                                                    data-bs-toggle="tooltip"
                                                    title="Hoàn thành">
                                                <i class="fas fa-check-circle"></i>
                                            </button>
                                        }

                                        @if (order.Status != 4 && order.Status != 5)
                                        {
                                            <button class="btn btn-outline-danger btn-sm"
                                                    onclick="updateOrderStatus(@order.Id, 5)"
                                                    data-bs-toggle="tooltip"
                                                    title="Hủy đơn hàng">
                                                <i class="fas fa-times"></i>
                                            </button>
                                        }
                                    </div>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        }
        else
        {
            <div class="text-center py-5">
                <i class="fas fa-shopping-cart text-muted" style="font-size: 4rem; opacity: 0.3;"></i>
                <h5 class="mt-3 text-muted">Chưa có đơn hàng nào</h5>
                <p class="text-muted">Đơn hàng sẽ xuất hiện ở đây khi khách hàng đặt mua</p>
            </div>
        }
    </div>
</div>

<!-- Pagination -->
@if (ViewBag.TotalPages > 1)
{
    <nav aria-label="Orders pagination" class="mt-4">
        <ul class="pagination justify-content-center">
            @if (ViewBag.CurrentPage > 1)
            {
                <li class="page-item">
                    <a class="page-link" href="@Url.Action("Orders", new { page = ViewBag.CurrentPage - 1 })">
                        <i class="fas fa-chevron-left"></i> Trước
                    </a>
                </li>
            }

            @for (int i = Math.Max(1, ViewBag.CurrentPage - 2); i <= Math.Min(ViewBag.TotalPages, ViewBag.CurrentPage + 2); i++)
            {
                <li class="page-item @(i == ViewBag.CurrentPage ? "active" : "")">
                    <a class="page-link" href="@Url.Action("Orders", new { page = i })">@i</a>
                </li>
            }

            @if (ViewBag.CurrentPage < ViewBag.TotalPages)
            {
                <li class="page-item">
                    <a class="page-link" href="@Url.Action("Orders", new { page = ViewBag.CurrentPage + 1 })">
                        Sau <i class="fas fa-chevron-right"></i>
                    </a>
                </li>
            }
        </ul>
    </nav>
}
